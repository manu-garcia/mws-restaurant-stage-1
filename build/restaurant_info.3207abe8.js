var restaurant_info=webpackJsonp_name_([1],{6:function(e,t,n){(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.RestaurantInfo=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r);n(1),n(2);t.RestaurantInfo=function(){function t(){e(this,t),this.restaurant=null,this.map=null,this.db=new i.default}return a(t,[{key:"fetchRestaurant",value:function(e){var t=this;if(this.restaurant)return void e(null,this.restaurant);var n=parseInt(this.getParameterByName("id"));n?this.db.fetchRestaurantById(n,function(a,r){if(t.restaurant=r,!r)return void console.error(a);t.db.fetchRestaurantReviews(n,function(n,a){r.reviews=a,t.fillRestaurantHTML(r),e(null,r)})}):(error="No restaurant id in url",e(error,null))}},{key:"fillRestaurantHTML",value:function(e){var t=this,n=document.getElementById("restaurant-name");n.innerHTML=e.name;var a=e.is_favorite?"selected":"";this.favoriteIcon=document.createElement("span"),this.favoriteIcon.className="favorite-icon "+a,this.favoriteIcon.innerHTML="&#9733;",this.favoriteIcon.onclick=function(n){parseInt(t.getParameterByName("id"));e.is_favorite=!e.is_favorite,t.db.setRestaurantFavorite(e).then(function(){var n=e.is_favorite?"selected":"";t.favoriteIcon.className="favorite-icon "+n})},n.appendChild(this.favoriteIcon),document.getElementById("restaurant-address").innerHTML=e.address;var r=document.getElementById("restaurant-img");r.className="restaurant-img",r.alt="Restaurant "+e.name,r.src=this.db.imageUrlForRestaurant(e),r.sizes="calc(100vw - 40px)",r.srcset=this.db.imageSrcsetForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&this.fillRestaurantHoursHTML(e.operating_hours),e.reviews&&this.fillReviewsHTML(e.reviews),this.addReviewButton||(this.addReviewButton=document.getElementById("add-new-review-button"),this.addReviewButton&&navigator.serviceWorker&&navigator.serviceWorker.ready.then(function(n){navigator.serviceWorker.addEventListener("message",function(e){if(e.data.command.startsWith("submit-new-review")){var n=e.data.command.split("-")[3];t.db.submitPendingReviewSW(n)}}),t.addReviewButton.addEventListener("click",function(a){a.preventDefault(),t.setOfflineReview().then(function(a){var r=parseInt(t.getParameterByName("id"));t.db.fetchOfflineOnlyRestaurantReviews(r,function(r,i){e.reviews=i,t.fillRestaurantHTML(e),n.sync.register("submit-new-review-"+a._id).then(function(){})})})})}))}},{key:"fillRestaurantHoursHTML",value:function(e){var t=document.getElementById("restaurant-hours");t.innerHTML="";for(var n in e){var a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);var i=document.createElement("td");i.innerHTML=e[n],a.appendChild(i),t.appendChild(a)}}},{key:"fillReviewsHTML",value:function(e){var t=this,n=document.getElementById("reviews-container");n.innerHTML="";var a=document.createElement("ul");a.id="reviews-list",n.appendChild(a);var r=document.createElement("h3");if(r.innerHTML="Reviews",n.appendChild(r),!e){var i=document.createElement("p");return i.innerHTML="No reviews yet!",void n.appendChild(i)}var o=1;e.forEach(function(e){a.appendChild(t.createReviewHTML(e,o)),o++}),n.appendChild(a)}},{key:"formatDate",value:function(e){if(!e)return"";var t=new Date(e),n=t.getDate(),a=t.getMonth(),r=t.getFullYear(),i=t.getMinutes();return r+"-"+(a+1)+"-"+n+" "+t.getHours()+":"+i}},{key:"createReviewHTML",value:function(e,t){var n=document.createElement("li");n.className=t%2?"odd":"even";var a=document.createElement("div");a.className="review-header",n.appendChild(a);var r=document.createElement("span");r.innerHTML=e.name,a.appendChild(r);var i=document.createElement("span");i.innerHTML=this.formatDate(e.updatedAt),a.appendChild(i);var o=document.createElement("div");o.className="review-body",n.appendChild(o);var u=document.createElement("span");u.innerHTML="Rating: "+e.rating,o.appendChild(u);var s=document.createElement("p");return s.innerHTML=e.comments,o.appendChild(s),n}},{key:"fillBreadcrumb",value:function(e){var t=document.getElementById("breadcrumb");t.innerHTML="";var n=document.createElement("li");n.innerHTML='<a href="/">Home</a>',n.setAttribute("aria-current","page"),t.appendChild(n);var a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-current","page"),t.appendChild(a)}},{key:"getParameterByName",value:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=n.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}},{key:"setOfflineReview",value:function(){var e=document.getElementById("add-new-review-form"),t=new FormData(e),n=parseInt(this.getParameterByName("id")),a={_id:Math.random().toString(36).substr(2,9),restaurant_id:n,name:t.get("name"),rating:parseInt(t.get("rating")),comments:t.get("comments")};return this.db.setOfflinePendingReview(a).then(function(){return e.reset(),a})}},{key:"initApp",value:function(){var e=this;this.initDB().then(function(){e.initMap()})}},{key:"initMap",value:function(){var e=this;this.fetchRestaurant(function(t,n){t?console.error(t):(e.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:n.latlng,scrollwheel:!1}),e.fillBreadcrumb(n),e.db.mapMarkerForRestaurant(e.restaurant,e.map))})}},{key:"initDB",value:function(){return this.db=new i.default,this.db.openDatabase()}}]),t}()}).call(window)}},[6]);