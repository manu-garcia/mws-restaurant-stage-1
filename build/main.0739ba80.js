var main=webpackJsonp_name_([0],[,,,function(t,e,n){(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Main=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n(4);var r=n(0),o=function(t){return t&&t.__esModule?t:{default:t}}(r);n(1),n(2);e.Main=function(){function e(){t(this,e),this.restaurants=[],this.neighborhoods=[],this.cuisines=[],this.map=null,this.markers=[],this.imageObserver=null,this.db=null}return i(e,[{key:"initApp",value:function(){var t=this;this.initDB().then(function(){t.initImageLazyLoader(),t.initMap(),t.fetchNeighborhoods(),t.fetchCuisines()})}},{key:"initDB",value:function(){var t=this;this.db=new o.default;this.db.openDatabase();return new Promise(function(e,n){t.db.fetchRestaurants(null,function(t,i){if(t)return n(t);e(i)})})}},{key:"initImageLazyLoader",value:function(){var t={threshold:.5};this.imageObserver=new IntersectionObserver(this.imageLazyLoader.bind(this),t)}},{key:"imageLazyLoader",value:function(t,e){var n=this;t.forEach(function(t){t.intersectionRatio>=.5&&n.lazyLoadImage(t.target)})}},{key:"lazyLoadImage",value:function(t){var e=t.dataset.sizes,n=t.dataset.srcset;this.fetchResponsiveImage(e,n).then(function(){t.sizes=e,t.srcset=n})}},{key:"fetchResponsiveImage",value:function(t,e){return new Promise(function(n,i){var r=new Image;r.sizes=t,r.srcset=e,r.onload=n,r.onerror=i})}},{key:"fetchNeighborhoods",value:function(){var t=this;this.db.fetchNeighborhoods(function(e,n){e?console.error("Main.fetchNeighborhoods: ",e):(t.neighborhoods=n,t.fillNeighborhoodsHTML())})}},{key:"fillNeighborhoodsHTML",value:function(){var t=document.getElementById("neighborhoods-select");this.neighborhoods&&this.neighborhoods.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}},{key:"fetchCuisines",value:function(){var t=this;this.db.fetchCuisines(function(e,n){e?console.error("Main.fetchCuisines: ",e):(t.cuisines=n,t.fillCuisinesHTML())})}},{key:"fillCuisinesHTML",value:function(){var t=document.getElementById("cuisines-select");this.cuisines&&this.cuisines.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}},{key:"initMap",value:function(){var t={lat:40.722216,lng:-73.987501};this.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:t,scrollwheel:!1}),this.updateRestaurants()}},{key:"updateRestaurants",value:function(){var t=this,e=document.getElementById("cuisines-select"),n=document.getElementById("neighborhoods-select"),i=e.selectedIndex,r=n.selectedIndex,o=e[i].value,s=n[r].value;this.db.fetchRestaurantByCuisineAndNeighborhood(o,s,function(e,n){e?console.error("Main.updateRestaurants: ",e):(t.resetRestaurants(n),t.fillRestaurantsHTML())})}},{key:"resetRestaurants",value:function(t){this.restaurants=[],document.getElementById("restaurants-list").innerHTML="",this.markers&&this.markers.forEach(function(t){return t.setMap(null)}),this.markers=[],this.restaurants=t}},{key:"fillRestaurantsHTML",value:function(){var t=this,e=document.getElementById("restaurants-list");this.restaurants&&(this.restaurants.forEach(function(n){e.append(t.createRestaurantHTML(n))}),this.addMarkersToMap())}},{key:"createRestaurantHTML",value:function(t){var e=document.createElement("li"),n=document.createElement("h2");n.innerHTML=t.name,e.append(n);var i=document.createElement("img");i.className="restaurant-img",i.alt="Restaurant "+t.name,i.src=this.db.imageUrlForRestaurant(t),i.setAttribute("data-sizes","(min-width: 750px) 40vw, 80vw"),i.setAttribute("data-srcset",this.db.imageSrcsetForRestaurant(t)),this.imageObserver.observe(i),e.append(i);var r=document.createElement("p");r.innerHTML=t.neighborhood,e.append(r);var o=document.createElement("p");o.innerHTML=t.address,e.append(o);var s=document.createElement("a");return s.innerHTML="View Details",s.href=this.db.urlForRestaurant(t),s.alt="Restaurant "+t.name,e.append(s),e}},{key:"addMarkersToMap",value:function(){var t=this;this.restaurants&&this.restaurants.forEach(function(e){var n=t.db.mapMarkerForRestaurant(e,t.map);google.maps.event.addListener(n,"click",function(){window.location.href=n.url}),t.markers.push(n)})}}]),e}()}).call(window)},function(t,e){!function(t,e){"use strict";function n(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||u(),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,i=this.intersectionRect,r=i.width*i.height;this.intersectionRatio=n?r/n:this.isIntersecting?1:0}function i(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=o(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function r(){return t.performance&&performance.now&&performance.now()}function o(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}function s(t,e,n,i){"function"==typeof t.addEventListener?t.addEventListener(e,n,i||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function a(t,e,n,i){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,i||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function c(t,e){var n=Math.max(t.top,e.top),i=Math.min(t.bottom,e.bottom),r=Math.max(t.left,e.left),o=Math.min(t.right,e.right),s=o-r,a=i-n;return s>=0&&a>=0&&{top:n,bottom:i,left:r,right:o,width:s,height:a}}function h(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):u()}function u(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function l(t,e){for(var n=e;n;){if(n==t)return!0;n=d(n)}return!1}function d(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e}if("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)return void("isIntersecting"in t.IntersectionObserverEntry.prototype||Object.defineProperty(t.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}));var f=[];i.prototype.THROTTLE_TIMEOUT=100,i.prototype.POLL_INTERVAL=null,i.prototype.USE_MUTATION_OBSERVER=!0,i.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},i.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},i.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},i.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},i.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},i.prototype._parseRootMargin=function(t){var e=t||"0px",n=e.split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},i.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(s(t,"resize",this._checkForIntersections,!0),s(e,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},i.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,a(t,"resize",this._checkForIntersections,!0),a(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},i.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():u();this._observationTargets.forEach(function(i){var o=i.element,s=h(o),a=this._rootContainsTarget(o),c=i.entry,u=t&&a&&this._computeTargetAndRootIntersection(o,e),l=i.entry=new n({time:r(),target:o,boundingClientRect:s,rootBounds:e,intersectionRect:u});c?t&&a?this._hasCrossedThreshold(c,l)&&this._queuedEntries.push(l):c&&c.isIntersecting&&this._queuedEntries.push(l):this._queuedEntries.push(l)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},i.prototype._computeTargetAndRootIntersection=function(n,i){if("none"!=t.getComputedStyle(n).display){for(var r=h(n),o=r,s=d(n),a=!1;!a;){var u=null,l=1==s.nodeType?t.getComputedStyle(s):{};if("none"==l.display)return;if(s==this.root||s==e?(a=!0,u=i):s!=e.body&&s!=e.documentElement&&"visible"!=l.overflow&&(u=h(s)),u&&!(o=c(u,o)))break;s=d(s)}return o}},i.prototype._getRootRect=function(){var t;if(this.root)t=h(this.root);else{var n=e.documentElement,i=e.body;t={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(t)},i.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},i.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,i=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==i)for(var r=0;r<this.thresholds.length;r++){var o=this.thresholds[r];if(o==n||o==i||o<n!=o<i)return!0}},i.prototype._rootIsInDom=function(){return!this.root||l(e,this.root)},i.prototype._rootContainsTarget=function(t){return l(this.root||e,t)},i.prototype._registerInstance=function(){f.indexOf(this)<0&&f.push(this)},i.prototype._unregisterInstance=function(){var t=f.indexOf(this);-1!=t&&f.splice(t,1)},t.IntersectionObserver=i,t.IntersectionObserverEntry=n}(window,document)}],[3]);